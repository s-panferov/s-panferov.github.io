<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>Promise и Deferred. Часть 1. Введение.</title>
    <meta name="description" content="Personal web blog about software development and code design.
">

    <link rel="stylesheet" href="/css/main.css">
    <link rel="canonical" href="http://panferov.me/2013/11/17/promises-part1-beginning.html">
</head>


  <body>

    <header class="site-header">

  <div class="wrapper">

    <a class="site-title" href="/">Stanislav Panferov</a>

    <nav class="site-nav">
      <a href="#" class="menu-icon">
        <svg viewBox="0 0 18 15">
          <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
      </a>

      <div class="trigger">
        
          
          <a class="page-link" href="/about/">About me</a>
          
        
          
        
          
        
          
        
      </div>
    </nav>

  </div>

</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="post">

  <header class="post-header">
    <h1 class="post-title">Promise и Deferred. Часть 1. Введение.</h1>
    <p class="post-meta">Nov 17, 2013</p>
  </header>

  <article class="post-content">
    <h2 id="section">Простыми словами</h2>

<p>Promise - в переводе с английского “обещание” - объект, позволяющий получить доступ к результату операции, которая могла еще не закончиться. Если вы пытаетесь использовать значение promise, а связанная с ним операция еще не завершена, то обработчик будет выполнен после завершения операции.</p>

<p>Предположим, вы хотите выполнить большой и сложный SQL-запрос, ждать выполнения которого придется не меньше 10-и секунд. В синхронном стиле мы написали бы что-то вроде:</p>

<div><div class="CodeRay">
  <div class="code"><pre><span class="line-numbers"><a href="#n1" name="n1">1</a></span>result = query(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">select * from big_table</span><span style="color:#710">'</span></span>); <span style="color:#777">// занимает 10 секунд</span>
</pre></div>
</div>
</div>

<!--more-->

<p>Данный код очень прост и понятен, но в таком случае ваша программа будет простаивать 10 секунд до получения резуальтата синхронной операции. Иногда это приемлено, но бывают ситуации, когда в это время можно сделать что-то еще, например, обработать запрос другого пользователя.</p>

<p>Вы можете использовать асинхронный подход и вернуть управление своей программе сразу же после выполнения запроса. Вы можете сделать это при помощи коллбека:</p>

<div><div class="CodeRay">
  <div class="code"><pre><span class="line-numbers"><a href="#n1" name="n1">1</a></span>query(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">select * from big_table</span><span style="color:#710">'</span></span>, <span style="color:#080;font-weight:bold">function</span>(result) {
<span class="line-numbers"><a href="#n2" name="n2">2</a></span>         <span style="color:#777">/* этот код будет вызван через 10 секунд */</span>
<span class="line-numbers"><a href="#n3" name="n3">3</a></span>});
</pre></div>
</div>
</div>

<p>В данном примере вы передаете в callback-функцию, которая будет вызвана с результатом после окончания обработки вашего запроса. Это довольно просто для понимания и решает нашу проблему - наша программа теперь может продолжить выполнение и не ждать окончания операции. Основное беспокойство в этом подходе вызывает тот факт, что проследить этапы выполнения программы становится сложнее, потому что порядок выполнения операций не так очевиден, как при использовании синхронного стиля. Также довольно сложно будет обеспечить выполнение операций вида “сделай A, B и С, а потом D”.</p>

<p>Тут на помощь приходят промисы. Вместо использования коллбека query может вернуть нам promise:</p>

<div><div class="CodeRay">
  <div class="code"><pre><span class="line-numbers"><a href="#n1" name="n1">1</a></span>promise = query(...); <span style="color:#777">// Возвращает управление сразу же</span>
</pre></div>
</div>
</div>

<p>В данном случае управление возвращается в наш код сразу же, а запрос выполняется в фоновом режиме. Основная идея в том, что promise не содержит результат операции на этом этапе. Если вы захотите что-то сделать с результатами операции - ваши действия будут отложены до фактического получения результата выполнения запроса.</p>

<div><div class="CodeRay">
  <div class="code"><pre><span class="line-numbers"><a href="#n1" name="n1">1</a></span>promise = query(...); <span style="color:#777">// Возвращает управление сразу.</span>
<span class="line-numbers"><a href="#n2" name="n2">2</a></span>do_something_with(promise); <span style="color:#777">// Выполняется через 10 секунд.</span>
</pre></div>
</div>
</div>

<p>Вы по прежнему можете сделать что-нибудь еще, пока ожидаете результата выполнения запроса:</p>

<div><div class="CodeRay">
  <div class="code"><pre><span class="line-numbers"><a href="#n1" name="n1">1</a></span>promise = query(...); <span style="color:#777">// Возвращает управление сразу.</span>
<span class="line-numbers"><a href="#n2" name="n2">2</a></span>do_something_else(); <span style="color:#777">// Выполняется сразу.</span>
<span class="line-numbers"><a href="#n3" name="n3">3</a></span>do_something_with(result_promise); <span style="color:#777">// Выполняется через 10 секунд.</span>
</pre></div>
</div>
</div>

<p>Основная польза от промисов в том, что иногда с их помощью можно сделать код чище, чем при использовании коллбек-функций: вам не нужно писать множество анонимных функций, операции, которым не нужен результат, могут быть выполнены сразу же.</p>

<p>Промисы могут дать вам основные преимещуства коллбек-фукнций (асинхронное выполнение вашего кода) и при этом позволяют вам писать чистый и простой в поддержке код. Вы получаете код, который выглядит почти так же, как синхронный, но выполняется он асинхронно.</p>

<h2 id="section-1">Источники</h2>

<ul>
  <li><a href="http://www.quora.com/JavaScript/What-is-the-promise-pattern">Этот ответ на Quora</a></li>
</ul>

  </article>

</div>

      </div>
    </div>

    <footer class="site-footer">

  <div class="wrapper">

    <h2 class="footer-heading">Stanislav Panferov</h2>

    <div class="footer-col-wrapper">

      <div class="footer-col  footer-col-2">
        <ul class="social-media-list">
          
          <li>
            <a href="https://github.com/s-panferov">
              <span class="icon  icon--github">
                <svg viewBox="0 0 16 16">
                  <path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/>
                </svg>
              </span>

              <span class="username">s-panferov</span>
            </a>
          </li>
          

          <li>
            <a href="http://ru.linkedin.com/pub/stanislav-panferov/65/bb2/a30">
              <span class="icon">
                <svg width="16px" height="16px" viewBox="0 0 60 60" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:sketch="http://www.bohemiancoding.com/sketch/ns">
                    <path d="M0.449161376,30 C0.449161376,13.4314567 13.6795217,0 30,0 C46.3204783,0 59.5508386,13.4314567 59.5508386,30 C59.5508386,46.5685433 46.3204783,60 30,60 C13.6795217,60 0.449161376,46.5685433 0.449161376,30 Z M0.449161376,30" fill="#007BB6" sketch:type="MSShapeGroup"></path>
                    <path d="M22.4680392,23.7098144 L15.7808366,23.7098144 L15.7808366,44.1369537 L22.4680392,44.1369537 L22.4680392,23.7098144 Z M22.4680392,23.7098144" id="Path" fill="#FFFFFF" sketch:type="MSShapeGroup"></path>
                    <path d="M22.9084753,17.3908761 C22.8650727,15.3880081 21.4562917,13.862504 19.1686418,13.862504 C16.8809918,13.862504 15.3854057,15.3880081 15.3854057,17.3908761 C15.3854057,19.3522579 16.836788,20.9216886 19.0818366,20.9216886 L19.1245714,20.9216886 C21.4562917,20.9216886 22.9084753,19.3522579 22.9084753,17.3908761 Z M22.9084753,17.3908761" id="Path" fill="#FFFFFF" sketch:type="MSShapeGroup"></path>
                    <path d="M46.5846502,32.4246563 C46.5846502,26.1503226 43.2856534,23.2301456 38.8851658,23.2301456 C35.3347011,23.2301456 33.7450983,25.2128128 32.8575489,26.6036896 L32.8575489,23.7103567 L26.1695449,23.7103567 C26.2576856,25.6271338 26.1695449,44.137496 26.1695449,44.137496 L32.8575489,44.137496 L32.8575489,32.7292961 C32.8575489,32.1187963 32.9009514,31.5097877 33.0777669,31.0726898 C33.5610713,29.8530458 34.6614937,28.5902885 36.5089747,28.5902885 C38.9297703,28.5902885 39.8974476,30.4634101 39.8974476,33.2084226 L39.8974476,44.1369537 L46.5843832,44.1369537 L46.5846502,32.4246563 Z M46.5846502,32.4246563" id="Path" fill="#FFFFFF" sketch:type="MSShapeGroup"></path>
                    <path d="M59.5508386,30 C59.5508386,46.5685433 46.3204783,60 30,60 C23.9471212,60 18.3192858,58.1525134 13.6339051,54.9827754 L47.4941264,5.81941103 C54.8060245,11.2806503 59.5508386,20.0777973 59.5508386,30 Z M59.5508386,30" id="reflec" fill-opacity="0.08" fill="#000000" sketch:type="MSShapeGroup"></path>
                </svg>
              </span>

              <span class="username">linkedin profile</span>
            </a>
          </li>

          
        </ul>
      </div>

      <div class="footer-col  footer-col-3">
        <p class="text">Personal web blog about software development and code design.
</p>
      </div>
    </div>

  </div>

</footer>


  </body>

</html>
