<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>Реактивный UI с использованием виртуальных деревьев</title>
    <meta name="description" content="Personal web blog about software development and code design.
">

    <link rel="stylesheet" href="/css/main.css">
    <link rel="canonical" href="http://panferov.me/2014/01/03/reactive.html">
</head>


  <body>

    <header class="site-header">

  <div class="wrapper">

    <a class="site-title" href="/">Stanislav Panferov</a>

    <nav class="site-nav">
      <a href="#" class="menu-icon">
        <svg viewBox="0 0 18 15">
          <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
      </a>

      <div class="trigger">
        
          
          <a class="page-link" href="/about/">About me</a>
          
        
          
        
          
        
          
        
      </div>
    </nav>

  </div>

</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="post">

  <header class="post-header">
    <h1 class="post-title">Реактивный UI с использованием виртуальных деревьев</h1>
    <p class="post-meta">Jan 3, 2014</p>
  </header>

  <article class="post-content">
    <h2 id="section">О материале</h2>

<p>Я решил написать серию статей на тему “Реактивный UI с использованием виртуальных деревьев” и собрать в ней общую теорию и практику данного подхода к проектированию интерактивных приложений.</p>

<p>В первой статье цикла я хотел бы рассмотреть общую теорию и эволюцию подходов к обеспечению “рекативности” — реакции приложения на действия пользователей и изменение данных. </p>

<p>Основная речь пойдет про веб и язык программирования JavaScript. Мы посмотрим на то, как обеспечивает реактивность Backbone, Angular, EmberJS и ReactJS. В следующих статьях я постараюсь более полно раскрыть теорию и практику разработки реактивных UI. Итак, поехали!</p>

<!--more-->

<h2 id="section-1">Эволюция походов проектирования приложений</h2>

<h3 id="section-2">Простой подход</h3>

<p>Простым подходом можно назвать ситуацию, когда разработчик пытается решить все задачи руками без какой-либо магии. В мире JavaScript простой подход к проектированию UI можно рассмотреть на примере библиотеки Backbone:</p>

<p>(Пример взят из TodoMVC на Backbone: http://todomvc.com/architecture-examples/backbone/)</p>

<div><div class="CodeRay">
  <div class="code"><pre><span class="line-numbers"> <a href="#n1" name="n1">1</a></span>app.AppView = Backbone.View.extend({
<span class="line-numbers"> <a href="#n2" name="n2">2</a></span>    <span style="color:#06B;font-weight:bold">render</span>: <span style="color:#080;font-weight:bold">function</span> () {
<span class="line-numbers"> <a href="#n3" name="n3">3</a></span>        <span style="color:#080;font-weight:bold">var</span> completed = app.todos.completed().length;
<span class="line-numbers"> <a href="#n4" name="n4">4</a></span>        <span style="color:#080;font-weight:bold">var</span> remaining = app.todos.remaining().length;
<span class="line-numbers"> <a href="#n5" name="n5">5</a></span>
<span class="line-numbers"> <a href="#n6" name="n6">6</a></span>        <span style="color:#080;font-weight:bold">if</span> (app.todos.length) {
<span class="line-numbers"> <a href="#n7" name="n7">7</a></span>            <span style="color:#950">this</span>.<span style="color:#369;font-weight:bold">$main</span>.show();
<span class="line-numbers"> <a href="#n8" name="n8">8</a></span>            <span style="color:#950">this</span>.<span style="color:#369;font-weight:bold">$footer</span>.show();
<span class="line-numbers"> <a href="#n9" name="n9">9</a></span>
<span class="line-numbers"><strong><a href="#n10" name="n10">10</a></strong></span>            <span style="color:#950">this</span>.<span style="color:#369;font-weight:bold">$footer</span>.html(<span style="color:#950">this</span>.statsTemplate({
<span class="line-numbers"><a href="#n11" name="n11">11</a></span>                <span style="color:#606">completed</span>: completed,
<span class="line-numbers"><a href="#n12" name="n12">12</a></span>                <span style="color:#606">remaining</span>: remaining
<span class="line-numbers"><a href="#n13" name="n13">13</a></span>            }));
<span class="line-numbers"><a href="#n14" name="n14">14</a></span>
<span class="line-numbers"><a href="#n15" name="n15">15</a></span>            <span style="color:#950">this</span>.<span style="color:#369;font-weight:bold">$</span>(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">#filters li a</span><span style="color:#710">'</span></span>)
<span class="line-numbers"><a href="#n16" name="n16">16</a></span>            .removeClass(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">selected</span><span style="color:#710">'</span></span>)
<span class="line-numbers"><a href="#n17" name="n17">17</a></span>            .filter(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">[href=&quot;#/</span><span style="color:#710">'</span></span> + (app.TodoFilter || <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#710">'</span></span>) + <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">&quot;]</span><span style="color:#710">'</span></span>)
<span class="line-numbers"><a href="#n18" name="n18">18</a></span>            .addClass(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">selected</span><span style="color:#710">'</span></span>);
<span class="line-numbers"><a href="#n19" name="n19">19</a></span>        } <span style="color:#080;font-weight:bold">else</span> {
<span class="line-numbers"><strong><a href="#n20" name="n20">20</a></strong></span>            <span style="color:#950">this</span>.<span style="color:#369;font-weight:bold">$main</span>.hide();
<span class="line-numbers"><a href="#n21" name="n21">21</a></span>            <span style="color:#950">this</span>.<span style="color:#369;font-weight:bold">$footer</span>.hide();
<span class="line-numbers"><a href="#n22" name="n22">22</a></span>        }
<span class="line-numbers"><a href="#n23" name="n23">23</a></span>
<span class="line-numbers"><a href="#n24" name="n24">24</a></span>        <span style="color:#950">this</span>.allCheckbox.checked = !remaining;
<span class="line-numbers"><a href="#n25" name="n25">25</a></span>    },
<span class="line-numbers"><a href="#n26" name="n26">26</a></span>
<span class="line-numbers"><a href="#n27" name="n27">27</a></span>    <span style="color:#777">// Add a single todo item to the list by creating a view for it, and</span>
<span class="line-numbers"><a href="#n28" name="n28">28</a></span>    <span style="color:#777">// appending its element to the `&lt;ul&gt;`.</span>
<span class="line-numbers"><a href="#n29" name="n29">29</a></span>    <span style="color:#06B;font-weight:bold">addOne</span>: <span style="color:#080;font-weight:bold">function</span> (todo) {
<span class="line-numbers"><strong><a href="#n30" name="n30">30</a></strong></span>        <span style="color:#080;font-weight:bold">var</span> view = <span style="color:#080;font-weight:bold">new</span> app.TodoView({ <span style="color:#606">model</span>: todo });
<span class="line-numbers"><a href="#n31" name="n31">31</a></span>        <span style="color:#950">this</span>.<span style="color:#369;font-weight:bold">$list</span>.append(view.render().el);
<span class="line-numbers"><a href="#n32" name="n32">32</a></span>    },
<span class="line-numbers"><a href="#n33" name="n33">33</a></span>
<span class="line-numbers"><a href="#n34" name="n34">34</a></span>    <span style="color:#777">// Add all items in the **Todos** collection at once.</span>
<span class="line-numbers"><a href="#n35" name="n35">35</a></span>    <span style="color:#06B;font-weight:bold">addAll</span>: <span style="color:#080;font-weight:bold">function</span> () {
<span class="line-numbers"><a href="#n36" name="n36">36</a></span>        <span style="color:#950">this</span>.<span style="color:#369;font-weight:bold">$list</span>.html(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#710">'</span></span>);
<span class="line-numbers"><a href="#n37" name="n37">37</a></span>        app.todos.each(<span style="color:#950">this</span>.addOne, <span style="color:#950">this</span>);
<span class="line-numbers"><a href="#n38" name="n38">38</a></span>    },
<span class="line-numbers"><a href="#n39" name="n39">39</a></span>
<span class="line-numbers"><strong><a href="#n40" name="n40">40</a></strong></span>    <span style="color:#06B;font-weight:bold">filterOne</span>: <span style="color:#080;font-weight:bold">function</span> (todo) {
<span class="line-numbers"><a href="#n41" name="n41">41</a></span>        todo.trigger(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">visible</span><span style="color:#710">'</span></span>);
<span class="line-numbers"><a href="#n42" name="n42">42</a></span>    },
<span class="line-numbers"><a href="#n43" name="n43">43</a></span>
<span class="line-numbers"><a href="#n44" name="n44">44</a></span>    <span style="color:#06B;font-weight:bold">filterAll</span>: <span style="color:#080;font-weight:bold">function</span> () {
<span class="line-numbers"><a href="#n45" name="n45">45</a></span>        app.todos.each(<span style="color:#950">this</span>.filterOne, <span style="color:#950">this</span>);
<span class="line-numbers"><a href="#n46" name="n46">46</a></span>    }
<span class="line-numbers"><a href="#n47" name="n47">47</a></span>});
</pre></div>
</div>
</div>

<p>На что следует обратить внимание?</p>

<ul>
  <li>Явные манипуляции с элементами DOM. Прямая установка свойств.</li>
  <li>Наличие методов <code>addOne</code> и <code>addAll</code>. Данные методы используются для реагирования UI на изменение данных.</li>
</ul>

<h4 id="section-3">Достоинства</h4>

<ul>
  <li>Полное управление ситуацией. Можно делать что угодно и когда угодно. Прямые манипуляции с деревом дают полную свободу действий.</li>
  <li>Скорость работы. Программист вручную прописывает все манипуляции с деревом и может контролировать и корректировать определенные нюансы производительности.</li>
</ul>

<h4 id="section-4">Недостатки</h4>

<ul>
  <li>Все манипуляции с деревом необходимо описывать вручную. Для каждого из способов изменения данных требуется писать код, отражающий это изменение на визуальное дерево.</li>
  <li>Больше кода порождает больше ошибок. Разработчики в простой модели должны быть очень бдительными.</li>
  <li>Состояние приложения невозможно восстановить на любой произвольный момент.</li>
</ul>

<h3 id="data-binding">Подход с использованием технологий data-binding</h3>

<p>Data-binding - технология автоматической синхронизации данных между моделью данных и визуальным деревом. Обычно в такой архитектуре данные рассматриваются как единственный источник “правды” для приложения. Что скрывается за этой фразой?</p>

<p>За этой фразой скрывается целый пласт технологий, который позволяют разработчику указать шаблоны для UI и правила биндинга данных — а фреймворк сам творит свою магию и обновляет UI при изменении данных. </p>

<p>Data-binding подход разделяется на два больших направления. Если подходить к вопросу поверхностно, то можно сказать, что различаются они вот так:</p>

<ul>
  <li>Plain Object архитектура. В такой архитектуре модель данных представляется набором примитивных объектов языка (например, POJO — Plain Old JavaScript Object, как любят говорить авторы фреймворков).</li>
  <li>Архитектура на толстых моделях.</li>
</ul>

<h4 id="data-binding---">Data-binding на простых объектах</h4>

<p>В данной архитектуре модели данных — примитивные объекты и их можно модифицировать, удалять и всячески над ними издеваться. Как же в такой неразберихе приложению узнать о том, какие данные поменялись и как?</p>

<p>Ответ очень прост, мы будет <strong>наблюдать</strong>. Для простоты объяснения предположим, что у нас есть глобальный объект с нашими данными о некоем человеке — <code>User</code>. Мы хотим извернуться и вывести на экран имя и фамилию этого человека, и при этом менять наше визуальное представление вместе с изменением данных.</p>

<div><div class="CodeRay">
  <div class="code"><pre><span class="line-numbers"><a href="#n1" name="n1">1</a></span><span style="color:#070;font-weight:bold">&lt;body&gt;</span>{{ User ? User.first_name + User.last_name : 'Unknown person' }}<span style="color:#070;font-weight:bold">&lt;/body&gt;</span>
</pre></div>
</div>
</div>

<p>В этом вымышленном куске кода я пользуюсь символами <code>{{ .. }}</code> для объявления “блока магии”, который будет обслуживаться фреймворком. Итак, что нужно сделать для того, чтобы эта магия заработала?</p>

<p>Для работы этой магии мы должны периодически вычислять значение выражения, стоящего внутри <code>{{ ... }}</code> и менять визуальное дерево в том случае, когда результат выражения изменился. Вот так вот просто!</p>

<p>В простейшем случае это можно делать по таймеру, например, раз в одну секунду вычислять все такие блоки и обновлять визуальное дерево. На практике, конечно, механизм проверки таких блоков действует несколько умнее, но это сильно зависит от реализации конкретного фреймворка.</p>

<p>В качестве подопытного в этой категории мы рассмотрим веб-фреймворк AngularJS. Заглянем в его TodoMVC (https://github.com/tastejs/todomvc/blob/gh-pages/architecture-examples/angularjs/index.html):</p>

<div><div class="CodeRay">
  <div class="code"><pre><span class="line-numbers"> <a href="#n1" name="n1">1</a></span><span style="color:#070;font-weight:bold">&lt;section</span> <span style="color:#b48">id</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">todoapp</span><span style="color:#710">&quot;</span></span> <span style="color:#b48">ng-controller</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">TodoCtrl</span><span style="color:#710">&quot;</span></span><span style="color:#070;font-weight:bold">&gt;</span>
<span class="line-numbers"> <a href="#n2" name="n2">2</a></span>    <span style="color:#070;font-weight:bold">&lt;header</span> <span style="color:#b48">id</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">header</span><span style="color:#710">&quot;</span></span><span style="color:#070;font-weight:bold">&gt;</span>
<span class="line-numbers"> <a href="#n3" name="n3">3</a></span>        <span style="color:#070;font-weight:bold">&lt;h1&gt;</span>todos<span style="color:#070;font-weight:bold">&lt;/h1&gt;</span>
<span class="line-numbers"> <a href="#n4" name="n4">4</a></span>        <span style="color:#070;font-weight:bold">&lt;form</span> <span style="color:#b48">id</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">todo-form</span><span style="color:#710">&quot;</span></span> <span style="color:#b48">ng-submit</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">addTodo()</span><span style="color:#710">&quot;</span></span><span style="color:#070;font-weight:bold">&gt;</span>
<span class="line-numbers"> <a href="#n5" name="n5">5</a></span>            <span style="color:#070;font-weight:bold">&lt;input</span> <span style="color:#b48">id</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">new-todo</span><span style="color:#710">&quot;</span></span> <span style="color:#b48">placeholder</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">What needs to be done?</span><span style="color:#710">&quot;</span></span> <span style="color:#b48">ng-model</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">newTodo</span><span style="color:#710">&quot;</span></span> <span style="color:#b48">autofocus</span><span style="color:#070;font-weight:bold">&gt;</span>
<span class="line-numbers"> <a href="#n6" name="n6">6</a></span>        <span style="color:#070;font-weight:bold">&lt;/form&gt;</span>
<span class="line-numbers"> <a href="#n7" name="n7">7</a></span>    <span style="color:#070;font-weight:bold">&lt;/header&gt;</span>
<span class="line-numbers"> <a href="#n8" name="n8">8</a></span>    <span style="color:#070;font-weight:bold">&lt;section</span> <span style="color:#b48">id</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">main</span><span style="color:#710">&quot;</span></span> <span style="color:#b48">ng-show</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">todos.length</span><span style="color:#710">&quot;</span></span> <span style="color:#b48">ng-cloak</span><span style="color:#070;font-weight:bold">&gt;</span>
<span class="line-numbers"> <a href="#n9" name="n9">9</a></span>        <span style="color:#070;font-weight:bold">&lt;input</span> <span style="color:#b48">id</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">toggle-all</span><span style="color:#710">&quot;</span></span> <span style="color:#b48">type</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">checkbox</span><span style="color:#710">&quot;</span></span> <span style="color:#b48">ng-model</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">allChecked</span><span style="color:#710">&quot;</span></span> <span style="color:#b48">ng-click</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">markAll(allChecked)</span><span style="color:#710">&quot;</span></span><span style="color:#070;font-weight:bold">&gt;</span>
<span class="line-numbers"><strong><a href="#n10" name="n10">10</a></strong></span>        <span style="color:#070;font-weight:bold">&lt;label</span> <span style="color:#b48">for</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">toggle-all</span><span style="color:#710">&quot;</span></span><span style="color:#070;font-weight:bold">&gt;</span>Mark all as complete<span style="color:#070;font-weight:bold">&lt;/label&gt;</span>
<span class="line-numbers"><a href="#n11" name="n11">11</a></span>        <span style="color:#070;font-weight:bold">&lt;ul</span> <span style="color:#b48">id</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">todo-list</span><span style="color:#710">&quot;</span></span><span style="color:#070;font-weight:bold">&gt;</span>
<span class="line-numbers"><a href="#n12" name="n12">12</a></span>            <span style="color:#070;font-weight:bold">&lt;li</span> <span style="color:#b48">ng-repeat</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">todo in todos | filter:statusFilter track by $index</span><span style="color:#710">&quot;</span></span> <span style="color:#b48">ng-class</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">{completed: todo.completed, editing: todo == editedTodo}</span><span style="color:#710">&quot;</span></span><span style="color:#070;font-weight:bold">&gt;</span>
<span class="line-numbers"><a href="#n13" name="n13">13</a></span>                <span style="color:#070;font-weight:bold">&lt;div</span> <span style="color:#b48">class</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">view</span><span style="color:#710">&quot;</span></span><span style="color:#070;font-weight:bold">&gt;</span>
<span class="line-numbers"><a href="#n14" name="n14">14</a></span>                    <span style="color:#070;font-weight:bold">&lt;input</span> <span style="color:#b48">class</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">toggle</span><span style="color:#710">&quot;</span></span> <span style="color:#b48">type</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">checkbox</span><span style="color:#710">&quot;</span></span> <span style="color:#b48">ng-model</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">todo.completed</span><span style="color:#710">&quot;</span></span><span style="color:#070;font-weight:bold">&gt;</span>
<span class="line-numbers"><a href="#n15" name="n15">15</a></span>                    <span style="color:#070;font-weight:bold">&lt;label</span> <span style="color:#b48">ng-dblclick</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">editTodo(todo)</span><span style="color:#710">&quot;</span></span><span style="color:#070;font-weight:bold">&gt;</span>{{todo.title}}<span style="color:#070;font-weight:bold">&lt;/label&gt;</span>
<span class="line-numbers"><a href="#n16" name="n16">16</a></span>                    <span style="color:#070;font-weight:bold">&lt;button</span> <span style="color:#b48">class</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">destroy</span><span style="color:#710">&quot;</span></span> <span style="color:#b48">ng-click</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">removeTodo(todo)</span><span style="color:#710">&quot;</span></span><span style="color:#070;font-weight:bold">&gt;</span><span style="color:#070;font-weight:bold">&lt;/button&gt;</span>
<span class="line-numbers"><a href="#n17" name="n17">17</a></span>                <span style="color:#070;font-weight:bold">&lt;/div&gt;</span>
<span class="line-numbers"><a href="#n18" name="n18">18</a></span>                <span style="color:#070;font-weight:bold">&lt;form</span> <span style="color:#b48">ng-submit</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">doneEditing(todo)</span><span style="color:#710">&quot;</span></span><span style="color:#070;font-weight:bold">&gt;</span>
<span class="line-numbers"><a href="#n19" name="n19">19</a></span>                    <span style="color:#070;font-weight:bold">&lt;input</span> <span style="color:#b48">class</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">edit</span><span style="color:#710">&quot;</span></span> <span style="color:#b48">ng-trim</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">false</span><span style="color:#710">&quot;</span></span> <span style="color:#b48">ng-model</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">todo.title</span><span style="color:#710">&quot;</span></span> <span style="color:#b48">todo-escape</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">revertEditing(todo)</span><span style="color:#710">&quot;</span></span> <span style="color:#b48">ng-blur</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">doneEditing(todo)</span><span style="color:#710">&quot;</span></span> <span style="color:#b48">todo-focus</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">todo == editedTodo</span><span style="color:#710">&quot;</span></span><span style="color:#070;font-weight:bold">&gt;</span>
<span class="line-numbers"><strong><a href="#n20" name="n20">20</a></strong></span>                <span style="color:#070;font-weight:bold">&lt;/form&gt;</span>
<span class="line-numbers"><a href="#n21" name="n21">21</a></span>            <span style="color:#070;font-weight:bold">&lt;/li&gt;</span>
<span class="line-numbers"><a href="#n22" name="n22">22</a></span>        <span style="color:#070;font-weight:bold">&lt;/ul&gt;</span>
<span class="line-numbers"><a href="#n23" name="n23">23</a></span>    <span style="color:#070;font-weight:bold">&lt;/section&gt;</span>
<span class="line-numbers"><a href="#n24" name="n24">24</a></span>    <span style="color:#070;font-weight:bold">&lt;footer</span> <span style="color:#b48">id</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">footer</span><span style="color:#710">&quot;</span></span> <span style="color:#b48">ng-show</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">todos.length</span><span style="color:#710">&quot;</span></span> <span style="color:#b48">ng-cloak</span><span style="color:#070;font-weight:bold">&gt;</span>
<span class="line-numbers"><a href="#n25" name="n25">25</a></span>        <span style="color:#070;font-weight:bold">&lt;span</span> <span style="color:#b48">id</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">todo-count</span><span style="color:#710">&quot;</span></span><span style="color:#070;font-weight:bold">&gt;</span><span style="color:#070;font-weight:bold">&lt;strong&gt;</span>{{remainingCount}}<span style="color:#070;font-weight:bold">&lt;/strong&gt;</span>
<span class="line-numbers"><a href="#n26" name="n26">26</a></span>            <span style="color:#070;font-weight:bold">&lt;ng-pluralize</span> <span style="color:#b48">count</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">remainingCount</span><span style="color:#710">&quot;</span></span> <span style="color:#b48">when</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">{ one: 'item left', other: 'items left' }</span><span style="color:#710">&quot;</span></span><span style="color:#070;font-weight:bold">&gt;</span><span style="color:#070;font-weight:bold">&lt;/ng-pluralize&gt;</span>
<span class="line-numbers"><a href="#n27" name="n27">27</a></span>        <span style="color:#070;font-weight:bold">&lt;/span&gt;</span>
<span class="line-numbers"><a href="#n28" name="n28">28</a></span>        <span style="color:#070;font-weight:bold">&lt;ul</span> <span style="color:#b48">id</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">filters</span><span style="color:#710">&quot;</span></span><span style="color:#070;font-weight:bold">&gt;</span>
<span class="line-numbers"><a href="#n29" name="n29">29</a></span>            <span style="color:#070;font-weight:bold">&lt;li&gt;</span>
<span class="line-numbers"><strong><a href="#n30" name="n30">30</a></strong></span>                <span style="color:#070;font-weight:bold">&lt;a</span> <span style="color:#b48">ng-class</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">{selected: status == ''} </span><span style="color:#710">&quot;</span></span> <span style="color:#b48">href</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">#/</span><span style="color:#710">&quot;</span></span><span style="color:#070;font-weight:bold">&gt;</span>All<span style="color:#070;font-weight:bold">&lt;/a&gt;</span>
<span class="line-numbers"><a href="#n31" name="n31">31</a></span>            <span style="color:#070;font-weight:bold">&lt;/li&gt;</span>
<span class="line-numbers"><a href="#n32" name="n32">32</a></span>            <span style="color:#070;font-weight:bold">&lt;li&gt;</span>
<span class="line-numbers"><a href="#n33" name="n33">33</a></span>                <span style="color:#070;font-weight:bold">&lt;a</span> <span style="color:#b48">ng-class</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">{selected: status == 'active'}</span><span style="color:#710">&quot;</span></span> <span style="color:#b48">href</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">#/active</span><span style="color:#710">&quot;</span></span><span style="color:#070;font-weight:bold">&gt;</span>Active<span style="color:#070;font-weight:bold">&lt;/a&gt;</span>
<span class="line-numbers"><a href="#n34" name="n34">34</a></span>            <span style="color:#070;font-weight:bold">&lt;/li&gt;</span>
<span class="line-numbers"><a href="#n35" name="n35">35</a></span>            <span style="color:#070;font-weight:bold">&lt;li&gt;</span>
<span class="line-numbers"><a href="#n36" name="n36">36</a></span>                <span style="color:#070;font-weight:bold">&lt;a</span> <span style="color:#b48">ng-class</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">{selected: status == 'completed'}</span><span style="color:#710">&quot;</span></span> <span style="color:#b48">href</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">#/completed</span><span style="color:#710">&quot;</span></span><span style="color:#070;font-weight:bold">&gt;</span>Completed<span style="color:#070;font-weight:bold">&lt;/a&gt;</span>
<span class="line-numbers"><a href="#n37" name="n37">37</a></span>            <span style="color:#070;font-weight:bold">&lt;/li&gt;</span>
<span class="line-numbers"><a href="#n38" name="n38">38</a></span>        <span style="color:#070;font-weight:bold">&lt;/ul&gt;</span>
<span class="line-numbers"><a href="#n39" name="n39">39</a></span>        <span style="color:#070;font-weight:bold">&lt;button</span> <span style="color:#b48">id</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">clear-completed</span><span style="color:#710">&quot;</span></span> <span style="color:#b48">ng-click</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">clearCompletedTodos()</span><span style="color:#710">&quot;</span></span> <span style="color:#b48">ng-show</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">completedCount</span><span style="color:#710">&quot;</span></span><span style="color:#070;font-weight:bold">&gt;</span>Clear completed ({{completedCount}})<span style="color:#070;font-weight:bold">&lt;/button&gt;</span>
<span class="line-numbers"><strong><a href="#n40" name="n40">40</a></strong></span>    <span style="color:#070;font-weight:bold">&lt;/footer&gt;</span>
<span class="line-numbers"><a href="#n41" name="n41">41</a></span><span style="color:#070;font-weight:bold">&lt;/section&gt;</span>
</pre></div>
</div>
</div>

<p>Как можно видеть из примера, вся архитектура Angular построена на тех самых наблюдениях. Посмотрите подробнее на этот чудесный код:</p>

<div><div class="CodeRay">
  <div class="code"><pre><span class="line-numbers"><a href="#n1" name="n1">1</a></span><span style="color:#070;font-weight:bold">&lt;li</span> <span style="color:#b48">ng-repeat</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">todo in todos | filter:statusFilter track by $index</span><span style="color:#710">&quot;</span></span> <span style="color:#b48">ng-class</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">{completed: todo.completed, editing: todo == editedTodo}</span><span style="color:#710">&quot;</span></span><span style="color:#070;font-weight:bold">&gt;</span>
<span class="line-numbers"><a href="#n2" name="n2">2</a></span>    ...
<span class="line-numbers"><a href="#n3" name="n3">3</a></span><span style="color:#070;font-weight:bold">&lt;/li&gt;</span>
</pre></div>
</div>
</div>

<p>Директива <code>ng-repeat</code> — отличный образец наблюдательной магии Angular. Она вычисляет выражение, записанное в значении атрибута и для каждого элемента из полученного массива объектов создает визуальный элемент исходя из внутреннего шаблона. </p>

<p>Директива <code>ng-class</code> также позволяет наблюдать за выражением, указанным в атрибуте и менять классы на элементе визуального дерева в зависимости от результата вычисления. Потрясающе!</p>

<h5 id="section-5">Достоинства</h5>

<ul>
  <li>Модель данных — источник правды. Это позволяет значительно уменьшить сложность построения приложения за счет того, что разработчику не требуется описывать большую часть логики применения изменений данных к визуальному дереву. </li>
  <li>Декларативный UI. Пишем меньше кода — делаем меньше ошибок. </li>
</ul>

<h5 id="section-6">Недостатки</h5>

<ul>
  <li>Для работы технологии в коде фреймворка или приложения требуется разработка способов реагирования на изменение данных (вспомним <code>ng-class</code>). Для каждого из возможных способов взаимодействия требуется реализация своего функционального блока. В Angular такие штуки называются <em>директивами</em>.</li>
  <li>Производительность модели начинает проседать, когда под наблюдением оказывается большое число выражений, ведь нам нужно вычислять новые значения для всех них каждый раз!</li>
</ul>

<h4 id="data-binding----1">Data-binding на толстых моделях</h4>

<p>Альтернативой POJO в мире современных визуальных фреймворков является биндинг на толстых моделях.</p>

<p>Толстой моделью я называю объект, который может оповещать наблюдателей о собственных изменениях (вспоминаем http://en.wikipedia.org/wiki/Observer_pattern).</p>

<p>В простейшем случае в качестве толстой модели можно рассмотреть объект, имеющий два метода: <code>get</code> и <code>set</code>, которые позволяют нам задавать и получать поля объекта. Рассмотрим пример из документации Ember:</p>

<div><div class="CodeRay">
  <div class="code"><pre><span class="line-numbers"> <a href="#n1" name="n1">1</a></span>App.Person = Ember.Object.extend({
<span class="line-numbers"> <a href="#n2" name="n2">2</a></span>  <span style="color:#06B;font-weight:bold">helloWorld</span>: <span style="color:#080;font-weight:bold">function</span>() {
<span class="line-numbers"> <a href="#n3" name="n3">3</a></span>    alert(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Hi, my name is </span><span style="color:#710">&quot;</span></span> + <span style="color:#950">this</span>.get(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">fullName</span><span style="color:#710">'</span></span>));
<span class="line-numbers"> <a href="#n4" name="n4">4</a></span>  }
<span class="line-numbers"> <a href="#n5" name="n5">5</a></span>});
<span class="line-numbers"> <a href="#n6" name="n6">6</a></span>
<span class="line-numbers"> <a href="#n7" name="n7">7</a></span><span style="color:#080;font-weight:bold">var</span> tom = App.Person.create({
<span class="line-numbers"> <a href="#n8" name="n8">8</a></span>  <span style="color:#606">fullName</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Tom Dale</span><span style="color:#710">&quot;</span></span>
<span class="line-numbers"> <a href="#n9" name="n9">9</a></span>});
<span class="line-numbers"><strong><a href="#n10" name="n10">10</a></strong></span>
<span class="line-numbers"><a href="#n11" name="n11">11</a></span>tom.helloWorld(); <span style="color:#777">// alerts &quot;Hi my name is Tom Dale&quot;</span>
</pre></div>
</div>
</div>

<p>Объект с таким сложным API уже никак не назовешь POJO, но у него есть одно замечательное свойство — он может оповещать слушателей об изменении себя любимого, когда кто-то вызывает метод <code>set</code>:</p>

<div><div class="CodeRay">
  <div class="code"><pre><span class="line-numbers"><a href="#n1" name="n1">1</a></span>person.addObserver(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">fullName</span><span style="color:#710">'</span></span>, <span style="color:#080;font-weight:bold">function</span>() {
<span class="line-numbers"><a href="#n2" name="n2">2</a></span>  <span style="color:#777">// делаем что-нибудь при изменении fullName</span>
<span class="line-numbers"><a href="#n3" name="n3">3</a></span>});
</pre></div>
</div>
</div>

<p>Это позволяет нам вместо периодического вычисления всех наблюдаемых блоков кода (вспомните, чем мы занимались в AngularJS) просто реагировать на изменения моделей, когда кто-то говорит <code>set</code>. В сочетании с такими возможностями как <strong>вычисляемые поля моделей</strong> и мощными шаблонами это дает нам еще один способ реагирования на изменения данных в нашем приложении.</p>

<h5 id="section-7">Преимущества</h5>

<ul>
  <li>Тратим меньше ресурсов для вычисления изменений UI.</li>
  <li>В нашем распоряжении “толстые модели”, в которые мы всегда можем добавить расширенную логику, валидации, преобразование данных, персистентность и прочие приятные мелочи. </li>
</ul>

<h5 id="section-8">Недостатки</h5>

<ul>
  <li>Появляются лишние тяжелые сущности в виде моделей, которые необходимо поддерживать. Это уменьшает гибкость кода и повышает порог вхождения.</li>
  <li>Сложно разрешаются ситуации, когда поле в шаблоне зависит от нескольких моделей сразу.</li>
  <li>Необходимость работать с геттерами и сеттерами и помнить о том, что каждое твое изменение модели запускает “магию”.</li>
</ul>

<h4 id="objectobserve">Object.observe</h4>

<p>Говоря о двух альтернативах data-binding будет грехом не упомянуть о новой возможности стандарта ECMAScript 6 — <a href="http://updates.html5rocks.com/2012/11/Respond-to-change-with-Object-observe">Object.observe</a>.</p>

<p>Эта штука обещает если не примирить два лагеря, то точно дать возможность стать ближе друг к другу. Если говорить коротко, то observe дает возможность подписываться на изменения POJO так же, как мы подписывались на толстую модель, то есть реализует для них паттерн “Observer”!</p>

<div><div class="CodeRay">
  <div class="code"><pre><span class="line-numbers"><a href="#n1" name="n1">1</a></span><span style="color:#080;font-weight:bold">var</span> beingWatched = {};
<span class="line-numbers"><a href="#n2" name="n2">2</a></span>
<span class="line-numbers"><a href="#n3" name="n3">3</a></span><span style="color:#777">// Определяем коллбек-функцию, которая будет получать оповещения об изменениях</span>
<span class="line-numbers"><a href="#n4" name="n4">4</a></span><span style="color:#080;font-weight:bold">function</span> <span style="color:#06B;font-weight:bold">somethingChanged</span>(changes) {
<span class="line-numbers"><a href="#n5" name="n5">5</a></span>    <span style="color:#777">// Делаем тут что-нибудь</span>
<span class="line-numbers"><a href="#n6" name="n6">6</a></span>}
<span class="line-numbers"><a href="#n7" name="n7">7</a></span>
<span class="line-numbers"><a href="#n8" name="n8">8</a></span>Object.observe(beingWatched, somethingChanged);
</pre></div>
</div>
</div>

<p>Этот подход может частично нивелировать те проблемы, которые мы имеем в подходе с толстыми моделями. На сегодняшний момент данных функционал уже доступен в последних версиях V8 (Chrome, Safari, Opera) и <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=800355">скоро</a> будет доступен в Firefox. </p>

<p>Чтож, осталось подождать и посмотреть, как <code>Object.observe</code> изменит мир дата-биндинга. Если же вы работаете с каким-нибудь другим языком и нем реализованы подобные возможности — смело беритесь перо и расскажите нам, как можно использовать эту технологию для облегчения разработки!</p>

<h3 id="section-9">Виртуальные визуальные деревья</h3>

<p>Все это время мы обсуждали с вами технологии создания интерфейсов, которые реагируют на изменения данных тем или иным способом. Давайте посмотрим на еще одну интересную реализацию идеи реактивного UI, который явила миру компания Facebook в своем продукте <a href="http://facebook.github.io/react/">ReactJS</a>.</p>

<p>Начнем с того, что ребята сделали одну очень интересную и необычную вещь. Вместо того, чтобы работать с DOM браузера, как делают все остальные, они взяли и создали свои объекты дерева!</p>

<p>Так, например, браузерный элемент <code>&lt;div&gt;</code> соответствует объекту <code>React.DOM.div</code>, а тег <code>&lt;a&gt;</code> соответствует <code>React.DOM.a</code>. Зачем они это сделали? Зачем плодить сущности и создавать свои объекты, когда можно пользоваться <a href="https://developer.mozilla.org/ru/docs/DOM/document.createElement">document.createElement</a>?</p>

<p>Ответ кроется в двух вещах:</p>

<ul>
  <li>Свои элементы визуального дерева создаются быстрее и “стоят” дешевле, потому что они не имеют нативного представления.</li>
  <li>Свои элементы можно расширить различными функциями, которых нет у браузерных DOM-элементов.</li>
</ul>

<p>Не буду больше вас томить и покажу пример из документации ReactJS:</p>

<div><div class="CodeRay">
  <div class="code"><pre><span class="line-numbers"> <a href="#n1" name="n1">1</a></span><span style="color:#080;font-weight:bold">var</span> Timer = React.createClass({
<span class="line-numbers"> <a href="#n2" name="n2">2</a></span>
<span class="line-numbers"> <a href="#n3" name="n3">3</a></span>  <span style="color:#06B;font-weight:bold">getInitialState</span>: <span style="color:#080;font-weight:bold">function</span>() {
<span class="line-numbers"> <a href="#n4" name="n4">4</a></span>    <span style="color:#080;font-weight:bold">return</span> {<span style="color:#606">secondsElapsed</span>: <span style="color:#00D">0</span>};
<span class="line-numbers"> <a href="#n5" name="n5">5</a></span>  },
<span class="line-numbers"> <a href="#n6" name="n6">6</a></span>
<span class="line-numbers"> <a href="#n7" name="n7">7</a></span>  <span style="color:#06B;font-weight:bold">tick</span>: <span style="color:#080;font-weight:bold">function</span>() {
<span class="line-numbers"> <a href="#n8" name="n8">8</a></span>    <span style="color:#950">this</span>.setState({<span style="color:#606">secondsElapsed</span>: <span style="color:#950">this</span>.state.secondsElapsed + <span style="color:#00D">1</span>});
<span class="line-numbers"> <a href="#n9" name="n9">9</a></span>  },
<span class="line-numbers"><strong><a href="#n10" name="n10">10</a></strong></span>
<span class="line-numbers"><a href="#n11" name="n11">11</a></span>  <span style="color:#06B;font-weight:bold">componentDidMount</span>: <span style="color:#080;font-weight:bold">function</span>() {
<span class="line-numbers"><a href="#n12" name="n12">12</a></span>    <span style="color:#950">this</span>.interval = setInterval(<span style="color:#950">this</span>.tick, <span style="color:#00D">1000</span>);
<span class="line-numbers"><a href="#n13" name="n13">13</a></span>  },
<span class="line-numbers"><a href="#n14" name="n14">14</a></span>
<span class="line-numbers"><a href="#n15" name="n15">15</a></span>  <span style="color:#06B;font-weight:bold">componentWillUnmount</span>: <span style="color:#080;font-weight:bold">function</span>() {
<span class="line-numbers"><a href="#n16" name="n16">16</a></span>    clearInterval(<span style="color:#950">this</span>.interval);
<span class="line-numbers"><a href="#n17" name="n17">17</a></span>  },
<span class="line-numbers"><a href="#n18" name="n18">18</a></span>
<span class="line-numbers"><a href="#n19" name="n19">19</a></span>  <span style="color:#06B;font-weight:bold">render</span>: <span style="color:#080;font-weight:bold">function</span>() {
<span class="line-numbers"><strong><a href="#n20" name="n20">20</a></strong></span>    <span style="color:#080;font-weight:bold">return</span> (
<span class="line-numbers"><a href="#n21" name="n21">21</a></span>      React.DOM.div({<span style="color:#606">style</span>: {<span style="color:#606"><span style="color:#404">'</span><span>background-color</span><span style="color:#404">'</span></span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">red</span><span style="color:#710">'</span></span>}}, 
<span class="line-numbers"><a href="#n22" name="n22">22</a></span>        <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Seconds Elapsed: </span><span style="color:#710">&quot;</span></span>, <span style="color:#950">this</span>.state.secondsElapsed)
<span class="line-numbers"><a href="#n23" name="n23">23</a></span>    );
<span class="line-numbers"><a href="#n24" name="n24">24</a></span>  }
<span class="line-numbers"><a href="#n25" name="n25">25</a></span>});
<span class="line-numbers"><a href="#n26" name="n26">26</a></span>
<span class="line-numbers"><a href="#n27" name="n27">27</a></span>React.renderComponent(Timer(), mountNode);
</pre></div>
</div>
</div>

<p>В терминологии ReactJS мы только что создали новый <strong>компонент</strong> Timer. Данный компонент занимается тем, что ежесекундно обновляет свое <strong>состояние</strong> при помощи функции <code>tick</code> и перерисовывается при изменении этого состояния.</p>

<p>Внимательный читатель уже заметил, что основная магия заключена в методе <code>render</code>:</p>

<div><div class="CodeRay">
  <div class="code"><pre><span class="line-numbers"><a href="#n1" name="n1">1</a></span><span style="color:#06B;font-weight:bold">render</span>: <span style="color:#080;font-weight:bold">function</span>() {
<span class="line-numbers"><a href="#n2" name="n2">2</a></span>    <span style="color:#080;font-weight:bold">return</span> React.DOM.div(<span style="color:#069">null</span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Seconds Elapsed: </span><span style="color:#710">&quot;</span></span>, <span style="color:#950">this</span>.state.secondsElapsed);
<span class="line-numbers"><a href="#n3" name="n3">3</a></span>}
</pre></div>
</div>
</div>

<p>Посмотрите, метод <code>render</code> возвращает нам экземпляр визуального дерева, состоящий в данном случае из одного элемента <code>div</code> без атрибутов, у которого детьми будут две текстовые ноды:</p>

<ol>
  <li>“Seconds Elapsed: “</li>
  <li>this.state.secondsElapsed</li>
</ol>

<p>Дальше работает специальная “магия”, которая отображает получившееся визуальное дерево ReactJS в дерево DOM.</p>

<p>Давайте попробуем формализовать, что же мы на текущий момент поняли:</p>

<ol>
  <li>Мы можем создавать свои компоненты, из которых можно собирать свое виртуальное визуальное дерево.</li>
  <li>Компоненты имеют <strong>опции</strong> (props) и <strong>внутреннее состояние</strong> (state).</li>
  <li>Компоненты предоставляют метод <code>render</code>, который должен вернуть визуальное дерево, соответствующее текущему набору <strong>опций</strong> и <strong>внутреннему состоянию</strong>.</li>
  <li>ReactJS сам заботится о том, чтобы наше виртуальное дерево отразилось на DOM.</li>
</ol>

<p>Эти четыре пункта описывают всю суть модели React. Попробую объяснить модель ReactJS чуть более подробно.</p>

<p>Представьте, что ваше приложение имеет конфигурационный файл, в который вы кладете описание состояние приложения и модели данных. Далее вы создаете большую функцию <code>render</code>, которая возвращает визуальное дерево в соответствии с этой конфигурацией. Каждый раз, когда вы хотите привести ваше приложение в новое состояние (например, показать новое окно), вы просто меняете конфигурацию и снова запускаете <code>render</code>.</p>

<p>Разумеется, данный утрированный подход полной перерисовки в реальной жизни будет довольно медленным и я вам его использовать в своих приложениях не советую. Тем не менее, это хороший способ осознать, как все работает.</p>

<p>В реальности ReactJS старается оптимизировать этой подход следующим образом:</p>

<ul>
  <li>Вам не обязательно вносить изменения в <strong>глобальный стейт</strong> приложения (наш конфигурационный файл), чтобы внести небольшие изменения в приложение. Вместо этого вы можете установить <strong>состояние</strong> отдельно взятому компоненту, что приведет к перерисовке только его поддерева.</li>
  <li>Используется специальный Diff-алгоритм, который позволяет оптимизировать рендеринг и сделать минимальное число изменений в ваше визуальное дерево.</li>
  <li>Вы можете сами на уровне компонента отслеживать ситуации, когда нужно обновлять свое визуально дерево, а когда нет.</li>
</ul>

<h4 id="section-10">Преимущества</h4>

<ul>
  <li>Все преобразования данных выполняются одним и тем же способом.</li>
  <li>State и Props - POJO, использование толстых моделей не обязательно.</li>
  <li>Маленькое количество сущностей обеспечивает быстрое вхождение.</li>
  <li>ReactJS сам выполняет преобразование из одного состояние визуального дерева в другое самым оптимальным путем. Это также приводит к тому, что сокращается объем кода.</li>
</ul>

<h4 id="section-11">Недостатки</h4>

<ul>
  <li>Возможны проблемы производительности при плохом проектировании приложения.</li>
</ul>

<h2 id="section-12">Выводы</h2>

<p>В данной статье я рассмотрел существующие подходы к созданию реактивных UI. В следующих статьях я буду дальше рассматривать технологию виртуальных деревьев и расскажу, как с ее помощи решаются типичные задачи.</p>

<p>Спасибо всем за внимание!</p>


  </article>

</div>

      </div>
    </div>

    <footer class="site-footer">

  <div class="wrapper">

    <h2 class="footer-heading">Stanislav Panferov</h2>

    <div class="footer-col-wrapper">

      <div class="footer-col  footer-col-2">
        <ul class="social-media-list">
          
          <li>
            <a href="https://github.com/s-panferov">
              <span class="icon  icon--github">
                <svg viewBox="0 0 16 16">
                  <path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/>
                </svg>
              </span>

              <span class="username">s-panferov</span>
            </a>
          </li>
          

          <li>
            <a href="http://ru.linkedin.com/pub/stanislav-panferov/65/bb2/a30">
              <span class="icon">
                <svg width="16px" height="16px" viewBox="0 0 60 60" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:sketch="http://www.bohemiancoding.com/sketch/ns">
                    <path d="M0.449161376,30 C0.449161376,13.4314567 13.6795217,0 30,0 C46.3204783,0 59.5508386,13.4314567 59.5508386,30 C59.5508386,46.5685433 46.3204783,60 30,60 C13.6795217,60 0.449161376,46.5685433 0.449161376,30 Z M0.449161376,30" fill="#007BB6" sketch:type="MSShapeGroup"></path>
                    <path d="M22.4680392,23.7098144 L15.7808366,23.7098144 L15.7808366,44.1369537 L22.4680392,44.1369537 L22.4680392,23.7098144 Z M22.4680392,23.7098144" id="Path" fill="#FFFFFF" sketch:type="MSShapeGroup"></path>
                    <path d="M22.9084753,17.3908761 C22.8650727,15.3880081 21.4562917,13.862504 19.1686418,13.862504 C16.8809918,13.862504 15.3854057,15.3880081 15.3854057,17.3908761 C15.3854057,19.3522579 16.836788,20.9216886 19.0818366,20.9216886 L19.1245714,20.9216886 C21.4562917,20.9216886 22.9084753,19.3522579 22.9084753,17.3908761 Z M22.9084753,17.3908761" id="Path" fill="#FFFFFF" sketch:type="MSShapeGroup"></path>
                    <path d="M46.5846502,32.4246563 C46.5846502,26.1503226 43.2856534,23.2301456 38.8851658,23.2301456 C35.3347011,23.2301456 33.7450983,25.2128128 32.8575489,26.6036896 L32.8575489,23.7103567 L26.1695449,23.7103567 C26.2576856,25.6271338 26.1695449,44.137496 26.1695449,44.137496 L32.8575489,44.137496 L32.8575489,32.7292961 C32.8575489,32.1187963 32.9009514,31.5097877 33.0777669,31.0726898 C33.5610713,29.8530458 34.6614937,28.5902885 36.5089747,28.5902885 C38.9297703,28.5902885 39.8974476,30.4634101 39.8974476,33.2084226 L39.8974476,44.1369537 L46.5843832,44.1369537 L46.5846502,32.4246563 Z M46.5846502,32.4246563" id="Path" fill="#FFFFFF" sketch:type="MSShapeGroup"></path>
                    <path d="M59.5508386,30 C59.5508386,46.5685433 46.3204783,60 30,60 C23.9471212,60 18.3192858,58.1525134 13.6339051,54.9827754 L47.4941264,5.81941103 C54.8060245,11.2806503 59.5508386,20.0777973 59.5508386,30 Z M59.5508386,30" id="reflec" fill-opacity="0.08" fill="#000000" sketch:type="MSShapeGroup"></path>
                </svg>
              </span>

              <span class="username">linkedin profile</span>
            </a>
          </li>

          
        </ul>
      </div>

      <div class="footer-col  footer-col-3">
        <p class="text">Personal web blog about software development and code design.
</p>
      </div>
    </div>

  </div>

</footer>


  </body>

</html>
